datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "cargo prisma"
  output   = "../src/prisma.rs"
}

model User {
  id                 BigInt     @id
  first_name         String
  last_name          String?
  username           String?    @unique
  language_code      String
  allows_write_to_pm Boolean    @default(false)
  photo_url          String?
  created_at         DateTime   @default(now())
  updated_at         DateTime   @updatedAt
  tasks              UserTask[]

  @@index([username])
  @@index([id])
}

model Task {
  id         BigInt     @id @default(autoincrement())
  task_data  Json
  created_at DateTime   @default(now())
  user_tasks UserTask[]

  @@index([id])
}

model UserTask {
  id           BigInt    @id @default(autoincrement())
  user         User      @relation(fields: [userId], references: [id])
  userId       BigInt
  task         Task      @relation(fields: [taskId], references: [id])
  taskId       BigInt
  score        Int       @default(0)
  completed_at DateTime?

  @@unique([userId, taskId])
  @@index([id])
}
